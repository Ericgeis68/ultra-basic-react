/* ========================================
   STYLES D'IMPRESSION - GMAO Application
   ======================================== */

/* Règles de page pour l'impression */
@page {
  size: A4;
  margin: 0;
}

/* Orientation contrôlée par classe (pour impression) */
@media print {
  .print-page.landscape {
    width: 297mm !important;
    min-height: 210mm !important;
  }
  .print-page.portrait {
    width: 210mm !important;
    height: 297mm !important;
  }
}

/* Styles pour l'impression réelle */
@media print {
  /* Reset des marges et padding */
  * {
    -webkit-print-color-adjust: exact !important;
    color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  /* Conteneur de page */
  .print-page {
    width: 210mm !important;
    min-height: 297mm !important;
    margin: 0 !important;
    padding: 0 !important;
    box-shadow: none !important;
    border: none !important;
    page-break-after: auto;
  }

  /* Contenu de la page */
  .print-content {
    width: 100% !important;
    height: 100% !important;
    padding: 10mm !important;
    box-sizing: border-box;
  }

  /* En-tête */
  .print-header {
    margin-bottom: 8mm !important;
    padding-bottom: 4mm !important;
    border-bottom: 0.5mm solid #000 !important;
  }

  .print-header h1 {
    font-size: 8mm !important;
    margin: 0 !important;
    font-weight: bold !important;
  }

  /* Pied de page */
  .print-footer {
    margin-top: 8mm !important;
    padding-top: 4mm !important;
    border-top: 0.5mm solid #000 !important;
    text-align: center !important;
    font-size: 3mm !important;
  }

  /* ========================================
     CARTES D'ÉQUIPEMENT - MODE GRID
     ======================================== */

  /* Réinitialiser tous les grids */
  .equipment-grid,
  .intervention-grid {
    display: grid !important;
    gap: 4mm !important;
    width: 100% !important;
  }
  
  /* Grilles spécifiques pour l'impression */
  .print-grid-1 {
    grid-template-columns: 1fr !important;
  }
  
  .print-grid-2 {
    grid-template-columns: 1fr 1fr !important;
  }
  
  .print-grid-3 {
    grid-template-columns: 1fr 1fr 1fr !important;
  }
  
  .print-grid-4 {
    grid-template-columns: repeat(4, 1fr) !important;
  }
  
  .print-grid-5 {
    grid-template-columns: repeat(5, 1fr) !important;
  }
  
  .print-grid-6 {
    grid-template-columns: repeat(6, 1fr) !important;
  }
  
  /* Override des classes Tailwind responsives */
  [class*="grid-cols-"] {
    display: grid !important;
  }
  
  /* Éviter les coupures de cartes */
  .equipment-card,
  .intervention-card {
    break-inside: avoid !important;
    page-break-inside: avoid !important;
    margin-bottom: 4mm;
  }
  
  /* S'assurer que les éléments ne deviennent pas inline */
  .equipment-grid > *,
  .intervention-grid > * {
    display: block !important;
  }

  /* Carte d'équipement */
  .equipment-card {
    border: 0.3mm solid #000 !important;
    border-radius: 2mm !important;
    padding: 3mm !important;
    background: white !important;
    page-break-inside: avoid;
  }

  /* Header de carte */
  .equipment-card .p-3,
  .equipment-card .p-4 {
    padding: 2mm !important;
  }

  .equipment-card h3 {
    font-size: 3.2mm !important; /* plus compact pour permettre plus de contenu */
    font-weight: bold !important;
    margin: 0 !important;
  }

  /* Badge de statut */
  .status-badge {
    font-size: 2.5mm !important;
    padding: 1mm 2mm !important;
    border-radius: 1mm !important;
  }

  /* Image d'équipement */
  .equipment-image {
    width: 100% !important;
    height: 25mm !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    overflow: hidden !important;
    border: 0.2mm solid #ccc !important;
    border-radius: 1mm !important;
  }
  .equipment-image img {
    max-width: 100% !important;
    max-height: 100% !important;
    width: auto !important;
    height: auto !important;
    object-fit: contain !important;
    object-position: center center !important;
    display: block !important;
  }

  /* Ajustement spécifique au paysage pour éviter l'écrasement visuel sur PDF */
  .print-page.landscape .equipment-image { height: 22mm !important; }

  /* Placeholder d'image */
  .equipment-card .image-placeholder {
    width: 100% !important;
    height: 25mm !important;
    border: 0.2mm solid #ccc !important;
    border-radius: 1mm !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
    background: white !important;
    font-size: 2.5mm !important;
    color: #666 !important;
  }

  /* Barre de santé */
  .health-bar {
    width: 100% !important;
    height: 1mm !important;
    background: #e5e5e5 !important;
    border-radius: 0.5mm !important;
    margin: 1mm 0 !important;
  }

  .health-bar-fill {
    height: 100% !important;
    background: #10b981 !important;
    border-radius: 0.5mm !important;
  }

  /* Sections de contenu */
  .equipment-card .space-y-3 > * + * {
    margin-top: 2mm !important;
  }

  .equipment-card h4 {
    font-size: 3mm !important;
    font-weight: bold !important;
    margin: 0 0 1mm 0 !important;
  }

  .equipment-card p {
    font-size: 2.5mm !important;
    margin: 0.5mm 0 !important;
    line-height: 1.2 !important;
  }

  /* ========================================
     TABLEAU - MODE LISTE
     ======================================== */

  .equipment-list table {
    width: 100% !important;
    border-collapse: collapse !important;
    font-size: 2.5mm !important;
  }

  .equipment-list th,
  .equipment-list td {
    border: 0.2mm solid #000 !important;
    padding: 1.5mm !important;
    text-align: left !important;
  }

  .equipment-list th {
    background: #f5f5f5 !important;
    font-weight: bold !important;
  }

  .equipment-list img {
    width: 8mm !important;
    height: 8mm !important;
    object-fit: contain !important;
  }

  /* ========================================
     CARTES D'INTERVENTION
     ======================================== */

  .intervention-card {
    border: 0.3mm solid #000 !important;
    border-radius: 2mm !important;
    padding: 3mm !important;
    background: white !important;
    page-break-inside: avoid;
  }

  .intervention-card h3 {
    font-size: 4mm !important;
    font-weight: bold !important;
    margin: 0 !important;
  }

  .intervention-card .badge {
    font-size: 2.5mm !important;
    padding: 1mm 2mm !important;
    border-radius: 1mm !important;
  }

  .intervention-card h4 {
    font-size: 3mm !important;
    font-weight: bold !important;
    margin: 0 0 1mm 0 !important;
  }

  .intervention-card p {
    font-size: 2.5mm !important;
    margin: 0.5mm 0 !important;
    line-height: 1.2 !important;
  }

  /* Forcer les tailles de police pour tous les éléments de texte dans les cartes d'intervention */
  .intervention-card .text-xs {
    font-size: 3mm !important; /* Augmenté de 2.5mm à 3mm */
  }

  .intervention-card .text-sm {
    font-size: 3.5mm !important; /* Augmenté de 3mm à 3.5mm */
  }

  .intervention-card .text-base {
    font-size: 4mm !important; /* Augmenté de 3.5mm à 4mm */
  }

  /* Forcer l'uniformité des tailles dans la carte unique */
  .intervention-card h3 {
    font-size: 3mm !important;
  }

  .intervention-card h4 {
    font-size: 2.5mm !important;
  }

  .intervention-card p {
    font-size: 2.5mm !important;
  }

  .intervention-card span {
    font-size: 2.5mm !important;
  }

  /* Styles pour l'historique des actions avec retour à la ligne */
  .intervention-card .technician-history-actions {
    word-break: break-word !important;
    white-space: pre-wrap !important;
    overflow-wrap: break-word !important;
    line-height: 1.3 !important;
    font-size: 3mm !important; /* Même taille que text-xs */
  }

  .intervention-card .technician-history-parts {
    word-break: break-word !important;
    white-space: pre-wrap !important;
    overflow-wrap: break-word !important;
    line-height: 1.2 !important;
    font-size: 3mm !important; /* Même taille que text-xs */
  }

  /* ========================================
     CSS DE DIAGNOSTIC (À SUPPRIMER APRÈS TEST)
     ======================================== */
  
  /* Décommentez ces lignes pour diagnostiquer les problèmes de grille */
  /*
  * {
    border: 1px solid red !important;
  }
  
  .equipment-grid {
    background: yellow !important;
    display: grid !important;
    grid-template-columns: 1fr 1fr 1fr !important;
  }
  
  .intervention-grid {
    background: lightblue !important;
    display: grid !important;
    grid-template-columns: 1fr 1fr 1fr !important;
  }
  */

  /* Masquer les éléments d'aperçu */
  .print\\:hidden {
    display: none !important;
  }

  /* Forcer l'affichage des éléments d'impression */
  .print\\:block {
    display: block !important;
  }

  /* Éviter les sauts de page dans les cartes */
  .equipment-card,
  .intervention-card {
    page-break-inside: avoid !important;
  }

  /* Saut de page avant les nouvelles pages */
  .page-break-before {
    page-break-before: always !important;
  }

  /* Saut de page après les pages */
  .page-break-after {
    page-break-after: always !important;
  }
}

/* ========================================
   STYLES POUR L'APERÇU ÉCRAN
   ======================================== */

@media screen {
  /* Conteneur de page pour l'aperçu */
  .print-page {
    width: 794px; /* Portrait par défaut: 210mm × 3.78 (96 DPI) */
    min-height: 1123px; /* Portrait: 297mm × 3.78 (96 DPI) */
    margin: 0 auto;
    padding: 0;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    border: 2px solid #d1d5db;
    border-radius: 8px;
    background: white;
    position: relative;
    overflow: visible; /* Autoriser le débordement pour éviter la coupe visuelle en aperçu */
    transform: scale(0.8); /* Échelle par défaut */
    transform-origin: top center;
  }

  /* Portrait spécifique pour les tableaux */
  .print-page.portrait {
    width: 794px;
    min-height: 1123px;
    overflow: visible;
  }

  /* Échelles d'aperçu personnalisables */
  .print-page[data-preview-scale="small"] {
    transform: scale(0.6);
  }

  .print-page[data-preview-scale="medium"] {
    transform: scale(0.8);
  }

  .print-page[data-preview-scale="large"] {
    transform: scale(1.0);
  }

  .print-page[data-preview-scale="auto"] {
    transform: scale(0.8);
  }
  /* Barre de santé pour l'aperçu écran */
  .health-bar {
    width: 100%;
    height: 6px;
    background: #e5e7eb;
    border-radius: 4px;
  }

  .health-bar-fill {
    height: 100%;
    background: #10b981;
    border-radius: 4px;
  }


  /* Paysage en aperçu écran */
  .print-page.landscape {
    width: 1123px; /* 297mm × 3.78 */
    min-height: 794px; /* 210mm × 3.78 */
    min-width: max-content; /* Permettre le débordement horizontal */
    transform: scale(0.7); /* Échelle par défaut en paysage */
    transform-origin: top center;
  }

  /* Échelles d'aperçu personnalisables pour le paysage */
  .print-page.landscape[data-preview-scale="small"] {
    transform: scale(0.5);
  }

  .print-page.landscape[data-preview-scale="medium"] {
    transform: scale(0.7);
  }

  .print-page.landscape[data-preview-scale="large"] {
    transform: scale(0.9);
  }

  .print-page.landscape[data-preview-scale="auto"] {
    transform: scale(0.7);
  }

  /* Indicateur visuel d'orientation (facultatif) */
  .print-page::after {
    content: attr(data-orientation);
    position: absolute;
    top: 8px;
    right: 12px;
    font-size: 12px;
    color: #6b7280;
    background: #f3f4f6;
    border: 1px solid #e5e7eb;
    padding: 2px 6px;
    border-radius: 9999px;
    text-transform: capitalize;
  }

  /* Contenu de la page pour l'aperçu */
  .print-content {
    width: 100%;
    height: 100%;
    padding: 24px; /* 6.35mm × 3.78 */
    box-sizing: border-box;
    position: relative;
  }

  /* Wrapper pour le zoom et le défilement horizontal */
  .print-zoom-wrapper {
    width: 100%;
    overflow: visible;
  }

  /* Forcer le défilement horizontal pour l'aperçu */
  .print-preview-container {
    min-width: max-content;
    width: 100%;
  }

  /* S'assurer que le contenu peut déborder horizontalement */
  .print-content {
    min-width: max-content;
  }

  /* En-tête pour l'aperçu */
  .print-header {
    margin-bottom: 24px; /* 6.35mm × 3.78 */
    padding-bottom: 16px; /* 4.23mm × 3.78 */
    border-bottom: 2px solid #d1d5db;
  }

  .print-header h1 {
    font-size: 32px; /* 8.47mm × 3.78 */
    margin: 0;
    font-weight: bold;
  }

  /* Grilles pour l'aperçu */
  .equipment-grid {
    display: grid !important;
    gap: 24px !important;
  }

  .intervention-grid {
    display: grid !important;
    gap: 24px !important;
  }

  /* Cartes pour l'aperçu */
  .equipment-card {
    border: 1px solid #d1d5db;
    border-radius: 8px;
  }

  .intervention-card {
    border: 1px solid #d1d5db;
    border-radius: 8px;
  }

  /* Styles pour l'aperçu écran - retour à la ligne */
  .intervention-card .technician-history-actions {
    word-break: break-word !important;
    white-space: pre-wrap !important;
    overflow-wrap: break-word !important;
    line-height: 1.3 !important;
    font-size: 14px !important; /* Augmenté de 12px à 14px */
  }

  .intervention-card .technician-history-parts {
    word-break: break-word !important;
    white-space: pre-wrap !important;
    overflow-wrap: break-word !important;
    line-height: 1.2 !important;
    font-size: 14px !important; /* Augmenté de 12px à 14px */
  }

  .intervention-card {
    padding: 12px;
    background: white;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    page-break-inside: avoid !important;
    break-inside: avoid !important;
  }

  /* Amélioration de l'aperçu d'impression */
  .print-preview {
    overflow: visible !important;
  }

  .print-page {
    overflow: visible !important;
    min-height: auto !important;
  }

  .print-content {
    overflow: visible !important;
    min-height: auto !important;
  }

  /* Grilles d'aperçu améliorées */
  .print-preview .grid {
    gap: 6mm !important;
    align-items: stretch !important; /* Force toutes les cartes à la même hauteur */
    grid-auto-rows: auto !important; /* Permet l'ajustement automatique des lignes */
  }

  .print-preview .grid > div {
    height: 100% !important; /* Force la hauteur complète */
    display: flex !important;
    flex-direction: column !important;
    min-height: 80mm !important; /* Hauteur minimale pour les cartes */
  }

  /* Uniformisation des cartes d'équipement */
  .print-preview .equipment-card {
    height: 100% !important;
    display: flex !important;
    flex-direction: column !important;
  }

  /* Champs uniformes dans les cartes */
  .print-preview .equipment-card .grid > div {
    height: 2.5rem !important; /* 40px - hauteur fixe pour tous les champs */
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
  }

  /* Description plus haute */
  .print-preview .equipment-card .mb-4.h-16 {
    height: 4rem !important; /* 64px pour la description */
  }

  /* Groupes plus hauts */
  .print-preview .equipment-card .mb-2.h-10 {
    height: 2.5rem !important; /* 40px pour les groupes */
  }

  /* Optimisation maximale de l'espace pour l'aperçu */
  .print-preview .print-page {
    padding: 5mm !important; /* Marges minimales */
  }

  .print-preview .print-content {
    padding: 0 !important; /* Suppression du padding interne */
  }

  /* En-têtes et pieds de page minimaux */
  .print-preview .print-header {
    margin-bottom: 4px !important;
    padding-bottom: 2px !important;
    font-size: 14px !important;
  }

  .print-preview .print-footer {
    margin-top: 4px !important;
    padding-top: 2px !important;
    font-size: 8px !important;
  }

  /* Espacement minimal entre les pages */
  .print-preview .print-page {
    margin-bottom: 12px !important;
  }

  .equipment-card img {
    width: 100%;
    height: 192px; /* 50.8mm × 3.78 */
    object-fit: contain;
    border: 1px solid #e5e7eb;
    border-radius: 4px;
  }

  .equipment-card .image-placeholder {
    width: 100%;
    height: 192px; /* 50.8mm × 3.78 */
    border: 1px solid #e5e7eb;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    font-size: 14px;
    color: #6b7280;
  }

  /* Tableau pour l'aperçu */
  .equipment-list table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  .equipment-list th,
  .equipment-list td {
    border: 1px solid #d1d5db;
    padding: 8px;
    text-align: left;
  }

  .equipment-list th {
    background: #f9fafb;
    font-weight: bold;
  }

  .equipment-list img {
    width: 64px; /* 16.93mm × 3.78 */
    height: 64px;
    object-fit: contain;
  }

  /* Quadrillage d'aperçu supprimé */
}
